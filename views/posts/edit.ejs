<% layout('layouts/boilerplate') -%>

<main class="auth-page">
  <div class="auth-container">
    <div class="auth-card">
      <div class="auth-logo">
        <img
          src="/images/Dribbble-logo.png"
          alt="Dribbble"
          class="logo-image"
        />
      </div>

      <div class="auth-header">
        <h1 class="auth-title">Edit Post</h1>
        <p class="auth-description">Update your creative work</p>
      </div>
      <% if (post.image) { %>
      <div class="current-image-preview">
        <img
          src="<%= post.image %>"
          class="preview-image"
          alt="Current post image"
        />
        <p class="preview-label">Current Image</p>
      </div>
      <% } %>

      <form
        class="auth-form needs-validation"
        action="/post/<%= post._id %>?_method=PUT"
        method="POST"
        enctype="multipart/form-data"
        novalidate
      >
        <div class="form-group">
          <label for="title" class="form-label">Project Title</label>
          <input
            type="text"
            class="form-input form-control"
            id="title"
            name="post[title]"
            value="<%= post.title || '' %>"
            placeholder="Enter your project title"
            minlength="3"
            maxlength="100"
            required
          />
          <div class="invalid-feedback">
            Project title must be between 3 and 100 characters long.
          </div>
        </div>

        <div class="form-group">
          <label for="image" class="form-label">Update Image</label>
          <input
            type="file"
            class="form-input form-control"
            id="image"
            name="post[image]"
            accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
          />
          <small class="form-helper-text"
            >Leave empty to keep current image</small
          >
          <div class="invalid-feedback">
            Please select a valid image file (JPEG, PNG, GIF, or WebP).
          </div>
        </div>

        <div class="form-group">
          <label for="description" class="form-label">Description</label>
          <textarea
            class="form-input form-control"
            id="description"
            name="post[description]"
            rows="4"
            placeholder="Describe your project..."
            maxlength="1000"
          >
<%= post.description || '' %></textarea
          >
          <div class="invalid-feedback">
            Description cannot exceed 1000 characters.
          </div>
        </div>

        <div class="form-group">
          <label for="tags" class="form-label">Tags</label>
          <input
            type="text"
            class="form-input form-control"
            id="tags"
            name="post[tags]"
            value="<%= post.tags ? post.tags.join(', ') : '' %>"
            placeholder="UI, UX, Design (comma separated)"
            pattern="^[a-zA-Z0-9\s,.-]*$"
          />
          <div class="invalid-feedback">
            Tags can only contain letters, numbers, spaces, commas, periods, and
            hyphens.
          </div>
        </div>

        <div class="btn-group-vertical">
          <button type="submit" class="btn btn-primary btn-save btn-full">
            <svg
              class="btn-icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"
              />
              <polyline points="17,21 17,13 7,13 7,21" />
              <polyline points="7,3 7,8 15,8" />
            </svg>
            Update Post
          </button>
          <a href="/post/<%= post._id %>" class="btn btn-cancel btn-full">
            <svg
              class="btn-icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M18 6L6 18" />
              <path d="M6 6l12 12" />
            </svg>
            Cancel
          </a>
        </div>
      </form>

      <div class="auth-footer">
        <p
          class="auth-terms"
          style="
            border-top: 1px solid #e7e7e9;
            padding-top: 1rem;
            margin-top: 1rem;
          "
        >
          <strong style="color: #dc2626">Danger Zone:</strong>
          This action cannot be undone. This will permanently delete your post.
        </p>
        <form
          action="/post/<%= post._id %>?_method=DELETE"
          method="POST"
          onsubmit="return confirm('Are you sure you want to delete this post? This action cannot be undone?')"
          style="margin-top: 1rem"
        >
          <button type="submit" class="btn btn-danger btn-delete btn-full">
            <svg
              class="btn-icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="3,6 5,6 21,6" />
              <path
                d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"
              />
            </svg>
            Delete Post
          </button>
        </form>
      </div>
    </div>
  </div>
</main>
